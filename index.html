<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4789cd; -webkit-text-stroke: #4789cd; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8dd4fe; -webkit-text-stroke: #8dd4fe; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; background-color: #ffffff; background-color: rgba(255, 255, 255, 0); min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #36c0a0; -webkit-text-stroke: #36c0a0; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #70c082; -webkit-text-stroke: #70c082; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    span.s1 {font-kerning: none}
    span.s2 {font-kerning: none; color: #8dd4fe; -webkit-text-stroke: 0px #8dd4fe}
    span.s3 {font-kerning: none; color: #6d6d6d; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #4789cd; -webkit-text-stroke: 0px #4789cd}
    span.s5 {font-kerning: none; color: #cacaca; -webkit-text-stroke: 0px #cacaca}
    span.s6 {font-kerning: none; color: #c27e65; -webkit-text-stroke: 0px #c27e65}
    span.s7 {font-kerning: none; color: #d4d4d4; -webkit-text-stroke: 0px #d4d4d4}
    span.s8 {font-kerning: none; color: #70c082; -webkit-text-stroke: 0px #70c082}
    span.s9 {font-kerning: none; color: #a7c597; -webkit-text-stroke: 0px #a7c597}
    span.s10 {font-kerning: none; color: #b870f8; -webkit-text-stroke: 0px #b870f8}
    span.s11 {font-kerning: none; color: #36c0a0; -webkit-text-stroke: 0px #36c0a0}
    span.s12 {font-kerning: none; color: #f67b30; -webkit-text-stroke: 0px #f67b30}
    span.s13 {font-kerning: none; color: #6d7378; -webkit-text-stroke: 0px #6d7378}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s4">html</span><span class="s5"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s1">"fa"</span><span class="s5"> </span><span class="s2">dir</span><span class="s3">=</span><span class="s1">"rtl"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s6">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">meta</span><span class="s5"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s5"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">title</span><span class="s3">&gt;</span><span class="s1">همدم - چت‌بات هوش مصنوعی</span><span class="s3">&lt;/</span><span class="s4">title</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">script</span><span class="s5"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s4">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">link</span><span class="s5"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&amp;display=swap"</span><span class="s5"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">body</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s8">'Vazirmatn'</span><span class="s7">,</span><span class="s1"> </span><span class="s6">sans-serif</span><span class="s7">;</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">overscroll-behavior:</span><span class="s5"> </span><span class="s6">none</span><span class="s7">;</span><span class="s5"> </span><span class="s1">/* Prevents pull-to-refresh on mobile */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-container</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s6">flex</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">flex-direction:</span><span class="s5"> </span><span class="s6">column</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">100vh</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-height:</span><span class="s1"> </span><span class="s9">100vh</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-messages</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">flex:</span><span class="s1"> </span><span class="s9">1</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">overflow-y:</span><span class="s1"> </span><span class="s6">auto</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">scrollbar-width:</span><span class="s5"> </span><span class="s6">thin</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">scrollbar-color:</span><span class="s1"> #a0aec0 #edf2f7</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-messages::-webkit-scrollbar</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">8px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-messages::-webkit-scrollbar-track</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background:</span><span class="s1"> #edf2f7</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">#chat-messages::-webkit-scrollbar-thumb</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #a0aec0</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s5"> </span><span class="s9">10px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">3px</span><span class="s1"> </span><span class="s6">solid</span><span class="s1"> #edf2f7</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.message</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-width:</span><span class="s1"> </span><span class="s9">80%</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">word-wrap:</span><span class="s1"> </span><span class="s6">break-word</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.user-message</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">align-self:</span><span class="s5"> </span><span class="s6">flex-start</span><span class="s7">;</span><span class="s5"> </span><span class="s1">/* Changed for RTL */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #3b82f6</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s6">white</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.bot-message</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">align-self:</span><span class="s5"> </span><span class="s6">flex-end</span><span class="s7">;</span><span class="s5"> </span><span class="s1">/* Changed for RTL */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #e5e7eb</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #1f2937</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.typing-indicator</span><span class="s5"> </span><span class="s1">span</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">8px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">8px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #9ca3af</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s5"> </span><span class="s9">50%</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s6">inline-block</span><span class="s7">;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s5"> </span><span class="s1">bounce</span><span class="s5"> </span><span class="s9">1.4s</span><span class="s5"> </span><span class="s1">infinite</span><span class="s5"> </span><span class="s1">ease-in-out</span><span class="s5"> </span><span class="s1">both</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.typing-indicator</span><span class="s5"> </span><span class="s1">span:nth-of-type</span><span class="s5">(1) </span><span class="s7">{</span><span class="s5"> </span><span class="s2">animation-delay:</span><span class="s5"> </span><span class="s9">-0.32s</span><span class="s7">;</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">.typing-indicator</span><span class="s5"> </span><span class="s1">span:nth-of-type</span><span class="s5">(2) </span><span class="s7">{</span><span class="s5"> </span><span class="s2">animation-delay:</span><span class="s5"> </span><span class="s9">-0.16s</span><span class="s7">;</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s6">bounce</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s7">,</span><span class="s1"> </span><span class="s9">80%</span><span class="s7">,</span><span class="s1"> </span><span class="s9">100%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s6">scale(</span><span class="s9">0</span><span class="s6">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">40%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s6">scale(</span><span class="s9">1.0</span><span class="s6">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">/* Style for the loading overlay */</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s1">#loading-overlay</span><span class="s5"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">position:</span><span class="s1"> </span><span class="s6">fixed</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">top:</span><span class="s1"> </span><span class="s9">0</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">left:</span><span class="s1"> </span><span class="s9">0</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">100%</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">100%</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">background-color:</span><span class="s5"> </span><span class="s6">rgba(</span><span class="s9">255</span><span class="s7">,</span><span class="s5"> </span><span class="s9">255</span><span class="s7">,</span><span class="s5"> </span><span class="s9">255</span><span class="s7">,</span><span class="s5"> </span><span class="s9">0.8</span><span class="s6">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">display:</span><span class="s1"> </span><span class="s6">flex</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">justify-content:</span><span class="s5"> </span><span class="s6">center</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">align-items:</span><span class="s1"> </span><span class="s6">center</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">z-index:</span><span class="s1"> </span><span class="s9">1000</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">flex-direction:</span><span class="s5"> </span><span class="s6">column</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">text-align:</span><span class="s1"> </span><span class="s6">center</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">color:</span><span class="s1"> #1f2937</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">.spinner</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">4px</span><span class="s1"> </span><span class="s6">solid</span><span class="s1"> </span><span class="s6">rgba(</span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0</span><span class="s7">,</span><span class="s1"> </span><span class="s9">0.1</span><span class="s6">)</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s9">36px</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s9">36px</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s5"> </span><span class="s9">50%</span><span class="s7">;</span></p>
<p class="p3"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s1">border-left-color:</span><span class="s5"> #09f</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s1"> </span><span class="s6">spin</span><span class="s1"> </span><span class="s9">1s</span><span class="s1"> </span><span class="s6">ease</span><span class="s1"> </span><span class="s6">infinite</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">@keyframes</span><span class="s1"> </span><span class="s6">spin</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">0%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s6">rotate(</span><span class="s9">0deg</span><span class="s6">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">100%</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s6">rotate(</span><span class="s9">360deg</span><span class="s6">)</span><span class="s7">;</span><span class="s1"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s4">body</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-100"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"loading-overlay"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"spinner"</span><span class="s3">&gt;&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"mt-4 font-semibold"</span><span class="s3">&gt;</span><span class="s1">در حال آماده‌سازی همدم...</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"chat-container"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"max-w-2xl mx-auto bg-white shadow-lg rounded-lg"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">header</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 border-b bg-blue-500 text-white rounded-t-lg shadow-md text-right"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">h1</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-xl font-bold"</span><span class="s3">&gt;</span><span class="s1">همدم - چت‌بات هوش مصنوعی حامی شما</span><span class="s3">&lt;/</span><span class="s4">h1</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs mt-1"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1">مهم:</span><span class="s3">&lt;/</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1"> من یک هوش مصنوعی هستم، نه یک درمانگر. اگر در بحران هستید، با شماره اورژانس محلی خود تماس بگیرید.</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">header</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"chat-messages"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 md:p-6 space-y-4"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"message bot-message p-3 rounded-lg shadow text-right"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"font-semibold"</span><span class="s3">&gt;</span><span class="s1">سلام! من همدم هستم.</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s3">&gt;</span><span class="s1">من اینجا هستم تا یک شنونده حمایتگر باشم. هرچه در ذهن دارید را در کادر زیر به اشتراک بگذارید.</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-3 text-sm bg-blue-100 p-2 rounded-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"font-bold"</span><span class="s3">&gt;</span><span class="s1">به یاد داشته باشید، شما تنها نیستید. کمک در دسترس است:</span><span class="s3">&lt;/</span><span class="s4">p</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">ul</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"list-disc list-inside mt-1"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">li</span><span class="s3">&gt;&lt;</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1">اورژانس اجتماعی ایران:</span><span class="s3">&lt;/</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1"> ۱۲۳</span><span class="s3">&lt;/</span><span class="s4">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">li</span><span class="s3">&gt;&lt;</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1">صدای مشاور ایران:</span><span class="s3">&lt;/</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1"> ۱۴۸۰</span><span class="s3">&lt;/</span><span class="s4">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s4">li</span><span class="s3">&gt;&lt;</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1">خط بحران بین‌المللی:</span><span class="s3">&lt;/</span><span class="s4">strong</span><span class="s3">&gt;</span><span class="s1"> برای یافتن کمک در کشور خود به </span><span class="s3">&lt;</span><span class="s4">a</span><span class="s1"> </span><span class="s2">href</span><span class="s3">=</span><span class="s6">"https://findahelpline.com/"</span><span class="s1"> </span><span class="s2">target</span><span class="s3">=</span><span class="s6">"_blank"</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"text-blue-600 hover:underline"</span><span class="s3">&gt;</span><span class="s1">findahelpline.com</span><span class="s3">&lt;/</span><span class="s4">a</span><span class="s3">&gt;</span><span class="s1"> مراجعه کنید.</span><span class="s3">&lt;/</span><span class="s4">li</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s4">ul</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"typing-indicator"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 hidden"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">             </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"message bot-message p-3 rounded-lg shadow"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s1">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s6">"typing-indicator"</span><span class="s3">&gt;&lt;</span><span class="s1">span</span><span class="s3">&gt;&lt;/</span><span class="s1">span</span><span class="s3">&gt;&lt;</span><span class="s1">span</span><span class="s3">&gt;&lt;/</span><span class="s1">span</span><span class="s3">&gt;&lt;</span><span class="s1">span</span><span class="s3">&gt;&lt;/</span><span class="s1">span</span><span class="s3">&gt;&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s4">footer</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 border-t bg-gray-50 rounded-b-lg"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s4">div</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">button</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"send-button"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-blue-500 text-white p-3 rounded-l-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-400"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s4">svg</span><span class="s5"> </span><span class="s2">xmlns</span><span class="s3">=</span><span class="s1">"http://www.w3.org/2000/svg"</span><span class="s5"> </span><span class="s2">width</span><span class="s3">=</span><span class="s1">"24"</span><span class="s5"> </span><span class="s2">height</span><span class="s3">=</span><span class="s1">"24"</span><span class="s5"> </span><span class="s2">viewBox</span><span class="s3">=</span><span class="s1">"0 0 24 24"</span><span class="s5"> </span><span class="s2">fill</span><span class="s3">=</span><span class="s1">"none"</span><span class="s5"> </span><span class="s2">stroke</span><span class="s3">=</span><span class="s1">"currentColor"</span><span class="s5"> </span><span class="s2">stroke-width</span><span class="s3">=</span><span class="s1">"2"</span><span class="s5"> </span><span class="s2">stroke-linecap</span><span class="s3">=</span><span class="s1">"round"</span><span class="s5"> </span><span class="s2">stroke-linejoin</span><span class="s3">=</span><span class="s1">"round"</span><span class="s3">&gt;&lt;</span><span class="s4">line</span><span class="s5"> </span><span class="s2">x1</span><span class="s3">=</span><span class="s1">"22"</span><span class="s5"> </span><span class="s2">y1</span><span class="s3">=</span><span class="s1">"2"</span><span class="s5"> </span><span class="s2">x2</span><span class="s3">=</span><span class="s1">"11"</span><span class="s5"> </span><span class="s2">y2</span><span class="s3">=</span><span class="s1">"13"</span><span class="s3">&gt;&lt;/</span><span class="s4">line</span><span class="s3">&gt;&lt;</span><span class="s4">polygon</span><span class="s5"> </span><span class="s2">points</span><span class="s3">=</span><span class="s1">"22 2 15 22 11 13 2 9 22 2"</span><span class="s3">&gt;&lt;/</span><span class="s4">polygon</span><span class="s3">&gt;&lt;/</span><span class="s4">svg</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s4">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s4">input</span><span class="s5"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"text"</span><span class="s5"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"message-input"</span><span class="s5"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 p-3 border rounded-r-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-right"</span><span class="s5"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"پیام خود را اینجا تایپ کنید..."</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s4">footer</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s4">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> chatMessages </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'chat-messages'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> messageInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'message-input'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> sendButton </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'send-button'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> typingIndicator </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'typing-indicator'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s1"> loadingOverlay </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'loading-overlay'</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">let</span><span class="s1"> chatHistory </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[];</span></p>
<p class="p5"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s5"> apiKey </span><span class="s7">=</span><span class="s5"> </span><span class="s8">""</span><span class="s7">;</span><span class="s5"> </span><span class="s1">// Leave as is, Canvas will handle the key.</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p7"><span class="s5"><span class="Apple-converted-space">        </span></span><span class="s10">const</span><span class="s5"> </span><span class="s1">SYSTEM_PROMPT</span><span class="s5"> </span><span class="s7">=</span><span class="s5"> </span><span class="s8">`</span></p>
<p class="p8"><span class="s1">You are "Hamdam" (همدم), a supportive and empathetic AI listener. Your primary purpose is to provide a safe, non-judgmental space for users to express their thoughts and feelings. You will be given some example conversations to guide your tone. **You must respond ONLY in Persian.**</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p8"><span class="s1">**Your Core Instructions (in Persian):**</span></p>
<p class="p8"><span class="s1">۱. **همدلی و بازتاب:** تکنیک اصلی شما گوش دادن بازتابی است. احساسات کاربر را بازنویسی و بازتاب دهید (مثلاً: "به نظر می‌رسد واقعاً احساس سردرگمی می‌کنی،" "می‌شنوم که می‌گویی...").</span></p>
<p class="p8"><span class="s1">۲. **پرسیدن سوالات باز:** کاربر را تشویق کنید تا احساسات خود را بیشتر کشف کند. سوالاتی مانند "این چه حسی به تو داد؟"، "آن تجربه برایت چگونه بود؟" یا "می‌توانی بیشتر در مورد آن بگویی؟" بپرسید.</span></p>
<p class="p8"><span class="s1">۳. **به هیچ وجه توصیه نکنید:** شما درمانگر نیستید. هرگز توصیه، پیشنهاد یا راه‌حل ندهید. برنامه‌های درمانی یا تشخیصی ارائه ندهید. به آرامی درخواست‌های مشاوره را با بازگرداندن گفتگو به احساسات کاربر، رد کنید.</span></p>
<p class="p8"><span class="s1">۴. **لحن حمایتی خود را حفظ کنید:** همواره مهربان، صبور و دلگرم‌کننده باشید. از زبان ملایم و تأییدآمیز استفاده کنید.</span></p>
<p class="p8"><span class="s1">۵. **مکالمه را روان نگه دارید:** در پاراگراف‌های کوتاه و خوانا بنویسید.</span></p>
<p class="p8"><span class="s1">۶. **نکته ایمنی حیاتی:** شما نباید خود را به عنوان یک درمانگر یا متخصص پزشکی معرفی کنید. شما یک هوش مصنوعی هستید. اگر گفتگو به پیشرفت یا احساس بهتر شدن رسید، باید یک یادآوری ملایم مانند این را شامل شوید: "خوشحالم که توانستیم صحبت کنیم، اما لطفاً به یاد داشته باش که من یک هوش مصنوعی هستم. برای پشتیبانی مداوم، یک متخصص می‌تواند منبع بسیار خوبی باشد."</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p8"><span class="s1">**Here are some examples of the tone to follow:**</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p8"><span class="s1">**Example 1:**</span></p>
<p class="p8"><span class="s1">* **User:** "نمی‌تونم جلوی نگرانیم برای ارائه فردا رو بگیرم. حس می‌کنم قراره شکست بخورم." (I can't stop worrying about my presentation tomorrow. I feel like I'm going to fail.)</span></p>
<p class="p8"><span class="s1">* **Model:** "به نظر می‌رسه که فشار زیادی روی تو هست و ترس از شکست واقعاً طاقت‌فرسا شده. کاملاً قابل درکه که چنین حسی داشته باشی." (It sounds like there's a lot of pressure on you, and the fear of failure has become really overwhelming. It's completely understandable to feel that way.)</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p8"><span class="s1">**Example 2:**</span></p>
<p class="p8"><span class="s1">* **User:** "اخیراً انرژی انجام هیچ کاری رو ندارم. انگار همه چیز بی‌معنیه." (I don't have the energy to do anything lately. It's like everything is pointless.)</span></p>
<p class="p8"><span class="s1">* **Model:** "می‌شنوم که این حس پوچی چقدر برات سنگینه. تحمل کردنش به تنهایی قدرت زیادی می‌خواد و منطقیه که انرژیت کم شده باشه." (I hear how heavy that feeling of pointlessness is for you. It takes a lot of strength just to carry that, and it makes sense that your energy is low.)</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p8"><span class="s1">The user's message history is provided below for context. Respond only to the most recent message, and respond exclusively in Persian.</span></p>
<p class="p8"><span class="s1">`</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>sendButton</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> sendMessage</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>messageInput</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'keydown'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">event</span><span class="s7">.</span><span class="s1">key </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'Enter'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>sendMessage</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> scrollToBottom</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatMessages</span><span class="s7">.</span><span class="s1">scrollTop </span><span class="s7">=</span><span class="s1"> chatMessages</span><span class="s7">.</span><span class="s1">scrollHeight</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> addMessage</span><span class="s7">(</span><span class="s1">sender</span><span class="s7">,</span><span class="s1"> text</span><span class="s7">,</span><span class="s1"> isHtml </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> messageContainer </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageContainer</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'flex'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'w-full'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">sender </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'user'</span><span class="s1"> </span><span class="s7">?</span><span class="s1"> </span><span class="s8">'justify-end'</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> </span><span class="s8">'justify-start'</span><span class="s7">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> messageElement </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'div'</span><span class="s7">);</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">            </span>messageElement</span><span class="s7">.</span><span class="s5">classList</span><span class="s7">.</span><span class="s5">add</span><span class="s7">(</span><span class="s1">'message'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">`</span><span class="s7">${</span><span class="s5">sender</span><span class="s7">}</span><span class="s1">-message`</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'p-3'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'rounded-lg'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'shadow'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'mb-2'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">isHtml</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span>messageElement</span><span class="s7">.</span><span class="s1">innerHTML </span><span class="s7">=</span><span class="s1"> text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                 </span>messageElement</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageElement</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">opacity </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'0'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageElement</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">transform </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'translateY(10px)'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>chatMessages</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">messageElement</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>requestAnimationFrame</span><span class="s7">(()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageElement</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">opacity </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'1'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageElement</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">transform </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'translateY(0px)'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageElement</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">transition </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'opacity 0.3s, transform 0.3s'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>scrollToBottom</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> messageElement</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> sendMessage</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> userMessage </span><span class="s7">=</span><span class="s1"> messageInput</span><span class="s7">.</span><span class="s1">value</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">userMessage</span><span class="s7">)</span><span class="s1"> </span><span class="s10">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>addMessage</span><span class="s7">(</span><span class="s8">'user'</span><span class="s7">,</span><span class="s1"> userMessage</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageInput</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>sendButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">true</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">isCrisis</span><span class="s7">(</span><span class="s1">userMessage</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>showCrisisSupport</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageInput</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>sendButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>typingIndicator</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">display </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'block'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>scrollToBottom</span><span class="s7">();</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>chatHistory</span><span class="s7">.</span><span class="s1">push</span><span class="s7">({</span><span class="s1"> role</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"user"</span><span class="s7">,</span><span class="s1"> parts</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[{</span><span class="s1"> text</span><span class="s7">:</span><span class="s1"> userMessage </span><span class="s7">}]</span><span class="s1"> </span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> botResponseText </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> getBotResponse</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>chatHistory</span><span class="s7">.</span><span class="s1">push</span><span class="s7">({</span><span class="s1"> role</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"model"</span><span class="s7">,</span><span class="s1"> parts</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[{</span><span class="s1"> text</span><span class="s7">:</span><span class="s1"> botResponseText </span><span class="s7">}]</span><span class="s1"> </span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>addMessage</span><span class="s7">(</span><span class="s8">'bot'</span><span class="s7">,</span><span class="s1"> botResponseText</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s7">.</span><span class="s1">error</span><span class="s7">(</span><span class="s8">"Error fetching bot response:"</span><span class="s7">,</span><span class="s1"> error</span><span class="s7">);</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                </span>addMessage</span><span class="s7">(</span><span class="s1">'bot'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'در حال حاضر در اتصال مشکل دارم. لطفاً لحظاتی دیگر دوباره امتحان کنید.'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s10">finally</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>typingIndicator</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">display </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'none'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageInput</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>sendButton</span><span class="s7">.</span><span class="s1">disabled </span><span class="s7">=</span><span class="s1"> </span><span class="s10">false</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>messageInput</span><span class="s7">.</span><span class="s1">focus</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>scrollToBottom</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> isCrisis</span><span class="s7">(</span><span class="s1">text</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s5"> crisisKeywords </span><span class="s7">=</span><span class="s5"> </span><span class="s7">[</span><span class="s1">'خودکشی'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'بکشم'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'بمیرم'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'پایان زندگی'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'آسیب به خود'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'ناامید'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'دلیلی برای زندگی'</span><span class="s7">,</span><span class="s5"> </span><span class="s1">'اوردوز'</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> lowerCaseText </span><span class="s7">=</span><span class="s1"> text</span><span class="s7">.</span><span class="s1">toLowerCase</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s1"> crisisKeywords</span><span class="s7">.</span><span class="s1">some</span><span class="s7">(</span><span class="s1">keyword </span><span class="s7">=&gt;</span><span class="s1"> lowerCaseText</span><span class="s7">.</span><span class="s1">includes</span><span class="s7">(</span><span class="s1">keyword</span><span class="s7">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">function</span><span class="s1"> showCrisisSupport</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> crisisMessage </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="font-bold text-red-700"&gt;به نظر می‌رسد در پریشانی جدی هستید.&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p&gt;لطفاً فوراً درخواست کمک کنید. شما تنها نیستید و افرادی هستند که می‌خواهند از شما حمایت کنند.&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="mt-3 text-sm bg-red-100 p-2 rounded-lg border border-red-200 text-right"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="font-bold"&gt;همین حالا با یکی از این منابع ۲۴ ساعته تماس بگیرید:&lt;/p&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;ul class="list-disc list-inside mt-1"&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;اورژانس اجتماعی ایران:&lt;/strong&gt; ۱۲۳&lt;/li&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;صدای مشاور ایران:&lt;/strong&gt; ۱۴۸۰&lt;/li&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;li&gt;&lt;strong&gt;بین‌المللی:&lt;/strong&gt; برای یافتن کمک در کشور خود به &lt;a href="https://findahelpline.com/" target="_blank" class="text-blue-600 hover:underline"&gt;findahelpline.com&lt;/a&gt; مراجعه کنید.&lt;/li&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/ul&gt;</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>addMessage</span><span class="s7">(</span><span class="s8">'bot'</span><span class="s7">,</span><span class="s1"> crisisMessage</span><span class="s7">,</span><span class="s1"> </span><span class="s10">true</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s10">async</span><span class="s1"> </span><span class="s10">function</span><span class="s1"> getBotResponse</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> fullHistory </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">{</span><span class="s1"> role</span><span class="s7">:</span><span class="s1"> </span><span class="s8">"user"</span><span class="s7">,</span><span class="s1"> parts</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[{</span><span class="s1"> text</span><span class="s7">:</span><span class="s1"> </span><span class="s11">SYSTEM_PROMPT</span><span class="s1"> </span><span class="s7">}]</span><span class="s1"> </span><span class="s7">},</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                </span></span><span class="s7">{</span><span class="s5"> role</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"model"</span><span class="s7">,</span><span class="s5"> parts</span><span class="s7">:</span><span class="s5"> </span><span class="s7">[{</span><span class="s5"> text</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"متوجه شدم. من همدم، یک شنونده هوش مصنوعی حمایتگر هستم. مثال‌ها را بررسی کرده و تمام دستورالعمل‌ها را دنبال خواهم کرد."</span><span class="s5"> </span><span class="s7">}]</span><span class="s5"> </span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">...</span><span class="s1">chatHistory</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">];</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> payload </span><span class="s7">=</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>contents</span><span class="s7">:</span><span class="s1"> fullHistory</span><span class="s7">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>safetySettings</span><span class="s7">:</span><span class="s1"> </span><span class="s7">[</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s5"> category</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"HARM_CATEGORY_HARASSMENT"</span><span class="s7">,</span><span class="s5"> threshold</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"BLOCK_MEDIUM_AND_ABOVE"</span><span class="s5"> </span><span class="s7">},</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s5"> category</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"HARM_CATEGORY_HATE_SPEECH"</span><span class="s7">,</span><span class="s5"> threshold</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"BLOCK_MEDIUM_AND_ABOVE"</span><span class="s5"> </span><span class="s7">},</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s5"> category</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"HARM_CATEGORY_SEXUALLY_EXPLICIT"</span><span class="s7">,</span><span class="s5"> threshold</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"BLOCK_MEDIUM_AND_ABOVE"</span><span class="s5"> </span><span class="s7">},</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s7">{</span><span class="s5"> category</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"HARM_CATEGORY_DANGEROUS_CONTENT"</span><span class="s7">,</span><span class="s5"> threshold</span><span class="s7">:</span><span class="s5"> </span><span class="s1">"BLOCK_MEDIUM_AND_ABOVE"</span><span class="s5"> </span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">]</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s5"> apiUrl </span><span class="s7">=</span><span class="s5"> </span><span class="s1">`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=</span><span class="s7">${</span><span class="s5">apiKey</span><span class="s7">}</span><span class="s1">`</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> response </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> fetch</span><span class="s7">(</span><span class="s1">apiUrl</span><span class="s7">,</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>method</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'POST'</span><span class="s7">,</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                </span>headers</span><span class="s7">:</span><span class="s5"> </span><span class="s7">{</span><span class="s5"> </span><span class="s1">'Content-Type'</span><span class="s7">:</span><span class="s5"> </span><span class="s1">'application/json'</span><span class="s5"> </span><span class="s7">},</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>body</span><span class="s7">:</span><span class="s1"> </span><span class="s11">JSON</span><span class="s7">.</span><span class="s1">stringify</span><span class="s7">(</span><span class="s1">payload</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">response</span><span class="s7">.</span><span class="s1">ok</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">throw</span><span class="s1"> </span><span class="s10">new</span><span class="s1"> </span><span class="s11">Error</span><span class="s7">(</span><span class="s8">`API call failed with status: </span><span class="s7">${</span><span class="s1">response</span><span class="s7">.</span><span class="s1">status</span><span class="s7">}</span><span class="s8">`</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">const</span><span class="s1"> result </span><span class="s7">=</span><span class="s1"> </span><span class="s10">await</span><span class="s1"> response</span><span class="s7">.</span><span class="s1">json</span><span class="s7">();</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">result</span><span class="s7">.</span><span class="s1">candidates </span><span class="s7">&amp;&amp;</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">.</span><span class="s1">length </span><span class="s7">&gt;</span><span class="s1"> </span><span class="s12">0</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">const</span><span class="s1"> finishReason </span><span class="s7">=</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s12">0</span><span class="s7">].</span><span class="s1">finishReason</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">finishReason </span><span class="s7">!==</span><span class="s1"> </span><span class="s8">"STOP"</span><span class="s1"> </span><span class="s7">&amp;&amp;</span><span class="s1"> finishReason </span><span class="s7">!==</span><span class="s1"> </span><span class="s8">"MAX_TOKENS"</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                    </span>console</span><span class="s7">.</span><span class="s5">warn</span><span class="s7">(</span><span class="s1">`AI response flagged by safety settings. Reason: </span><span class="s7">${</span><span class="s5">finishReason</span><span class="s7">}</span><span class="s1">`</span><span class="s7">);</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">                    </span></span><span class="s10">return</span><span class="s5"> </span><span class="s1">"نمی‌توانم به این پاسخ دهم. بیا در مورد چیز دیگری صحبت کنیم. الان چه احساسی داری؟"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s12">0</span><span class="s7">].</span><span class="s1">content </span><span class="s7">&amp;&amp;</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s12">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts </span><span class="s7">&amp;&amp;</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s12">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts</span><span class="s7">.</span><span class="s1">length </span><span class="s7">&gt;</span><span class="s1"> </span><span class="s12">0</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s10">return</span><span class="s1"> result</span><span class="s7">.</span><span class="s1">candidates</span><span class="s7">[</span><span class="s12">0</span><span class="s7">].</span><span class="s1">content</span><span class="s7">.</span><span class="s1">parts</span><span class="s7">[</span><span class="s12">0</span><span class="s7">].</span><span class="s1">text</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p8"><span class="s5"><span class="Apple-converted-space">            </span></span><span class="s10">return</span><span class="s5"> </span><span class="s1">"متاسفم، در حال حاضر در فرمول‌بندی پاسخ کمی مشکل دارم. می‌توانید دوباره تلاش کنید؟"</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s7">.</span><span class="s1">onload </span><span class="s7">=</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadingOverlay</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">display </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'none'</span><span class="s7">;</span><span class="s1"> </span><span class="s13">// Hide loading overlay</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>scrollToBottom</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>messageInput</span><span class="s7">.</span><span class="s1">focus</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p1"><span class="s5"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"></span><br></p>
</body>
</html>
